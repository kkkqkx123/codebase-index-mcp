# 核心改进建议

## 1. 代码解析和分块策略升级
- **当前状态**：简单文本分块，缺乏语法感知
- **改进建议**：采用tree-sitter多语言语法解析器

### 建议的智能分块接口
```typescript
interface SmartCodeParser {
  parseFile(filePath: string): Promise<CodeBlock[]>;
  parseContent(content: string, language: string): Promise<CodeBlock[]>;
}

interface CodeBlock {
  filePath: string;
  identifier: string | null;
  type: string; // function, class, markdown_header_h1, etc.
  startLine: number;
  endLine: number;
  content: string;
  segmentHash: string; // SHA256去重
  fileHash: string;
}
```


## 2. 多嵌入器提供商支持
- **当前状态**：仅支持OpenAI嵌入
- **改进建议**：支持多种嵌入提供商

### 嵌入器接口体系
| 嵌入器类型          | 支持模型示例                |
|---------------------|-----------------------------|
| OpenAI嵌入器        | text-embedding-004          |
| Ollama嵌入器        | codestral-embed-2505        |
| OpenAI兼容嵌入器    | -                           |
| Gemini嵌入器        | -                           |
| 自定义模型          | 自定义配置模型              |


## 3. 向量存储优化 - 路径段索引
- **当前状态**：基础向量存储，缺乏目录级过滤
- **改进建议**：实现路径段索引机制

### 路径段索引示例
```typescript
// 路径段索引示例
const pathSegments = {
  "pathSegments.0": "src",
  "pathSegments.1": "services", 
  "pathSegments.2": "code-index",
  "pathSegments.3": "parser.ts"
};

// 支持目录前缀查询
await vectorStore.search(queryVector, "src/services", 0.8, 10);
```


## 4. 增量索引和实时更新
- **当前状态**：全量索引，缺乏实时性
- **改进建议**：文件监视器 + 增量更新

### 文件监视器接口
```typescript
interface FileWatcher {
  watch(workspacePath: string): Promise<void>;
  onFileChange(callback: (filePath: string) => void): void;
  onFileDelete(callback: (filePath: string) => void): void;
}
```

### 增量索引流程
1. 文件变更检测 → 2. 解析变更文件 → 3. 生成嵌入向量 → 4. 更新向量存储


## 5. 错误处理和监控增强
- **当前状态**：基础错误处理
- **改进建议**：完善的监控体系

### 监控系统接口
```typescript
interface MonitoringSystem {
  trackEmbeddingTime(duration: number): void;
  trackIndexingProgress(processed: number, total: number): void;
  trackError(error: Error, context: string): void;
  getPerformanceMetrics(): PerformanceMetrics;
}
```