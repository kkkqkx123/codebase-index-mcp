# LSPé›†æˆå®æ–½è·¯çº¿å›¾

## æ‰§è¡Œæ‘˜è¦

åŸºäºè¯¦ç»†åˆ†æï¼ŒLSPé›†æˆå°†åˆ†å››ä¸ªé˜¶æ®µå®æ–½ï¼Œé‡‡ç”¨**æ¸è¿›å¼å¢å¼ºç­–ç•¥**ï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œå‘åå…¼å®¹æ€§ã€‚

## å®æ–½é˜¶æ®µæ€»è§ˆ

| é˜¶æ®µ | æ—¶é—´ | ç›®æ ‡ | å…³é”®äº¤ä»˜ç‰© | é£é™©çº§åˆ« |
|------|------|------|------------|----------|
| **é˜¶æ®µ1: åŸºç¡€æ¡†æ¶** | 1-2å‘¨ | LSPåŸºç¡€æ¶æ„ | LSPManager, å®¢æˆ·ç«¯æ±  | ä½ |
| **é˜¶æ®µ2: ç´¢å¼•é›†æˆ** | 2-3å‘¨ | ç´¢å¼•æµç¨‹å¢å¼º | EnhancedParserService | ä¸­ |
| **é˜¶æ®µ3: æœç´¢å¢å¼º** | 1-2å‘¨ | æœç´¢åŠŸèƒ½å‡çº§ | LSPSearchService | ä½ |
| **é˜¶æ®µ4: ç”Ÿäº§ä¼˜åŒ–** | 1-2å‘¨ | æ€§èƒ½è°ƒä¼˜ | ç¼“å­˜, ç›‘æ§, éƒ¨ç½² | ä½ |

## è¯¦ç»†å®æ–½è®¡åˆ’

### ğŸ“‹ é˜¶æ®µ1: åŸºç¡€æ¡†æ¶ (Week 1-2)

#### ç›®æ ‡
å»ºç«‹LSPåŸºç¡€æ¶æ„ï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯ç®¡ç†ã€è¿æ¥æ± å’ŒåŸºç¡€é€šä¿¡åè®®ã€‚

#### ä»»åŠ¡æ¸…å•

**Week 1: æ ¸å¿ƒç»„ä»¶**
- [ ] åˆ›å»º `src/services/lsp/` ç›®å½•ç»“æ„
- [ ] å®ç° `LSPClient` åŸºç¡€é€šä¿¡ç±»
- [ ] å®ç° `LSPClientPool` è¿æ¥æ± ç®¡ç†
- [ ] åˆ›å»º `LanguageServerRegistry` é…ç½®ç®¡ç†
- [ ] å®ç°åŸºç¡€é”™è¯¯å¤„ç†æœºåˆ¶

**Week 2: é…ç½®å’Œæµ‹è¯•**
- [ ] æ·»åŠ  `lsp-config.yml` é…ç½®æ–‡ä»¶
- [ ] å®ç°é¡¹ç›®è¯­è¨€æ£€æµ‹é€»è¾‘
- [ ] åˆ›å»ºLSPå®¢æˆ·ç«¯å•å…ƒæµ‹è¯•
- [ ] æ·»åŠ Dockeræ”¯æŒè¯­è¨€æœåŠ¡å™¨
- [ ] å®ŒæˆåŸºç¡€é›†æˆæµ‹è¯•

#### ä»£ç ç¤ºä¾‹

```typescript
// é˜¶æ®µ1å®Œæˆåå¯ç”¨API
const lspManager = container.get<LSPManager>(TYPES.LSPManager);

// åˆå§‹åŒ–é¡¹ç›®
await lspManager.initialize('./my-project');

// åŸºç¡€æŸ¥è¯¢
const diagnostics = await lspManager.getDiagnostics('index.ts');
const symbols = await lspManager.getSymbols('index.ts');
```

#### éªŒæ”¶æ ‡å‡†
- [ ] æ”¯æŒTypeScript/JavaScriptè¯­è¨€æœåŠ¡å™¨
- [ ] è¿æ¥æ± æœ€å¤§10ä¸ªå¹¶å‘è¿æ¥
- [ ] åŸºç¡€é”™è¯¯ç‡ < 5%
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

### ğŸ“‹ é˜¶æ®µ2: ç´¢å¼•é›†æˆ (Week 3-5)

#### ç›®æ ‡
å°†LSPåŠŸèƒ½é›†æˆåˆ°ç´¢å¼•æµç¨‹ï¼Œå®ç°è¯­ä¹‰å¢å¼ºçš„ä»£ç è§£æã€‚

#### ä»»åŠ¡æ¸…å•

**Week 3: ParserServiceå¢å¼º**
- [ ] å®ç° `EnhancedParserService` è£…é¥°å™¨æ¨¡å¼
- [ ] æ·»åŠ LSPå¢å¼ºåˆ° `ParseResult`
- [ ] å®ç°ç»“æœèåˆé€»è¾‘
- [ ] æ·»åŠ é…ç½®å¼€å…³ `enableLSP`

**Week 4: ç´¢å¼•æµç¨‹é›†æˆ**
- [ ] ä¿®æ”¹ `IndexCoordinator` æ”¯æŒLSPé˜¶æ®µ
- [ ] å®ç° `LSPEnhancementPhase`
- [ ] æ·»åŠ æ‰¹é‡å¤„ç†ä¼˜åŒ–
- [ ] å®ç°ç¼“å­˜å¤±æ•ˆæœºåˆ¶

**Week 5: æµ‹è¯•å’Œè°ƒä¼˜**
- [ ] åˆ›å»ºé›†æˆæµ‹è¯•é¡¹ç›®
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†å’Œé™çº§æµ‹è¯•

#### ä»£ç ç¤ºä¾‹

```typescript
// é˜¶æ®µ2å®Œæˆåç´¢å¼•é€‰é¡¹
const result = await indexService.createIndex('./project', {
  enableLSP: true,
  lspTimeout: 30000,
  cacheLSP: true
});

// å¢å¼ºçš„è§£æç»“æœ
const parseResult = await parserService.parseFile('user.ts', {
  includeLSP: true,
  includeTypes: true
});
```

#### éªŒæ”¶æ ‡å‡†
- [ ] ç´¢å¼•æ—¶é—´å¢åŠ  < 30%
- [ ] è¯­ä¹‰ä¿¡æ¯å‡†ç¡®ç‡ > 95%
- [ ] å†…å­˜ä½¿ç”¨å¢åŠ  < 100MB
- [ ] é™çº§åˆ°Tree-sitteræ— ä¸­æ–­

### ğŸ“‹ é˜¶æ®µ3: æœç´¢å¢å¼º (Week 6-7)

#### ç›®æ ‡
å®ç°åŸºäºLSPçš„è¯­ä¹‰æœç´¢åŠŸèƒ½ï¼Œæå‡æœç´¢å‡†ç¡®æ€§ã€‚

#### ä»»åŠ¡æ¸…å•

**Week 6: æœç´¢æœåŠ¡å¢å¼º**
- [ ] å®ç° `LSPSearchService`
- [ ] æ·»åŠ ç¬¦å·æœç´¢ç­–ç•¥
- [ ] å®ç°ç»“æœèåˆç®—æ³•
- [ ] æ·»åŠ æœç´¢ç›¸å…³æ€§è¯„åˆ†

**Week 7: é«˜çº§æœç´¢åŠŸèƒ½**
- [ ] å®ç°ç±»å‹å®šä¹‰æœç´¢
- [ ] æ·»åŠ å¼•ç”¨æŸ¥æ‰¾åŠŸèƒ½
- [ ] å®ç°å®æ—¶æœç´¢å»ºè®®
- [ ] ä¼˜åŒ–æœç´¢æ€§èƒ½

#### ä»£ç ç¤ºä¾‹

```typescript
// é˜¶æ®µ3å®Œæˆåæœç´¢åŠŸèƒ½
const results = await searchService.search('UserService', {
  enableLSP: true,
  searchTypes: ['symbol', 'definition', 'reference'],
  includeDiagnostics: true
});
```

#### éªŒæ”¶æ ‡å‡†
- [ ] æœç´¢å‡†ç¡®ç‡æå‡ > 40%
- [ ] å“åº”æ—¶é—´ < 500ms
- [ ] æ”¯æŒç¬¦å·ã€ç±»å‹ã€å¼•ç”¨æœç´¢
- [ ] ç¼“å­˜å‘½ä¸­ç‡ > 70%

### ğŸ“‹ é˜¶æ®µ4: ç”Ÿäº§ä¼˜åŒ– (Week 8-9)

#### ç›®æ ‡
ä¼˜åŒ–æ€§èƒ½ã€æ·»åŠ ç›‘æ§ã€å®Œå–„éƒ¨ç½²æ–¹æ¡ˆã€‚

#### ä»»åŠ¡æ¸…å•

**Week 8: æ€§èƒ½ä¼˜åŒ–**
- [ ] å®ç°å¤šå±‚ç¼“å­˜ç­–ç•¥
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§æŒ‡æ ‡
- [ ] ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- [ ] å®ç°è¿æ¥æ± è°ƒä¼˜

**Week 9: éƒ¨ç½²å’Œæ–‡æ¡£**
- [ ] åˆ›å»ºç”Ÿäº§Dockeré•œåƒ
- [ ] æ·»åŠ ç›‘æ§å‘Šè­¦
- [ ] ç¼–å†™éƒ¨ç½²æ–‡æ¡£
- [ ] åˆ›å»ºä½¿ç”¨ç¤ºä¾‹

#### æœ€ç»ˆé…ç½®ç¤ºä¾‹

```yaml
# lsp-config.yml (æœ€ç»ˆç‰ˆæœ¬)
lsp:
  enabled: true
  
  languages:
    typescript:
      enabled: true
      server: "typescript-language-server"
      timeout: 30000
      
    python:
      enabled: true
      server: "pylsp"
      timeout: 15000
      
  cache:
    enabled: true
    ttl: 1800
    max_size: 10000
    
  performance:
    max_connections: 10
    batch_size: 20
    retry_attempts: 3
```

## æŠ€æœ¯æ ˆå’Œä¾èµ–

### æ–°å¢ä¾èµ–

```json
{
  "dependencies": {
    "vscode-languageserver-protocol": "^3.17.0",
    "vscode-languageclient": "^8.0.0",
    "node-ipc": "^11.1.0"
  },
  "devDependencies": {
    "@types/node-ipc": "^9.2.0",
    "typescript-language-server": "^4.0.0"
  }
}
```

### Dockeré•œåƒæ‰©å±•

```dockerfile
# ç”Ÿäº§ç¯å¢ƒè¯­è¨€æœåŠ¡å™¨
FROM node:18-alpine

# å®‰è£…è¯­è¨€æœåŠ¡å™¨
RUN npm install -g typescript-language-server@4.0.0
RUN pip install python-lsp-server[all]

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
EXPOSE 3000

CMD ["npm", "start"]
```

## é£é™©è¯„ä¼°å’Œç¼“è§£

### ä¸»è¦é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£ç­–ç•¥ |
|------|------|------|----------|
| **è¯­è¨€æœåŠ¡å™¨ä¸å¯ç”¨** | ä¸­ | é«˜ | ä¼˜é›…é™çº§åˆ°Tree-sitter |
| **æ€§èƒ½ä¸‹é™** | ä¸­ | ä¸­ | ç¼“å­˜ä¼˜åŒ–å’Œå¹¶å‘æ§åˆ¶ |
| **å†…å­˜æ³„æ¼** | ä½ | é«˜ | è¿æ¥æ± ç®¡ç†å’Œå®šæœŸæ¸…ç† |
| **å…¼å®¹æ€§é—®é¢˜** | ä½ | ä¸­ | å…¨é¢æµ‹è¯•å’Œç‰ˆæœ¬é”å®š |

### å›æ»šç­–ç•¥

```typescript
// ç´§æ€¥å›æ»šå¼€å…³
const emergencyConfig = {
  disableAllLSP: false,
  fallbackToTreeSitter: true,
  maxRetries: 0
};

// è¿è¡Œæ—¶åˆ‡æ¢
if (emergencyConfig.disableAllLSP) {
  lspManager.disableAllServers();
  parserService.useTreeSitterOnly();
}
```

## æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”

```
å•å…ƒæµ‹è¯• (70%)
â”œâ”€â”€ LSPClient æµ‹è¯•
â”œâ”€â”€ LSPManager æµ‹è¯•
â”œâ”€â”€ é…ç½®è§£ææµ‹è¯•
â””â”€â”€ é”™è¯¯å¤„ç†æµ‹è¯•

é›†æˆæµ‹è¯• (20%)
â”œâ”€â”€ ç´¢å¼•æµç¨‹æµ‹è¯•
â”œâ”€â”€ æœç´¢åŠŸèƒ½æµ‹è¯•
â”œâ”€â”€ ç¼“å­˜ä¸€è‡´æ€§æµ‹è¯•
â””â”€â”€ é™çº§æœºåˆ¶æµ‹è¯•

ç«¯åˆ°ç«¯æµ‹è¯• (10%)
â”œâ”€â”€ å®Œæ•´é¡¹ç›®æµ‹è¯•
â”œâ”€â”€ æ€§èƒ½åŸºå‡†æµ‹è¯•
â””â”€â”€ ç”Ÿäº§ç¯å¢ƒæ¨¡æ‹Ÿ
```

### æµ‹è¯•é¡¹ç›®

```bash
# åˆ›å»ºæµ‹è¯•é¡¹ç›®
test-projects/
â”œâ”€â”€ typescript-project/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ user.ts
â”‚   â”‚   â”œâ”€â”€ service.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ python-project/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â””â”€â”€ service.py
â”‚   â””â”€â”€ requirements.txt
â””â”€â”€ mixed-project/
    â”œâ”€â”€ frontend/
    â”œâ”€â”€ backend/
    â””â”€â”€ shared/
```

## æ€§èƒ½åŸºå‡†

### ç›®æ ‡æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å½“å‰åŸºçº¿ | ç›®æ ‡ | å¤‡æ³¨ |
|------|----------|------|------|
| **ç´¢å¼•æ—¶é—´** | 100æ–‡ä»¶/åˆ†é’Ÿ | â‰¤130æ–‡ä»¶/åˆ†é’Ÿ | å¢åŠ <30% |
| **æœç´¢å“åº”** | 200ms | â‰¤500ms | LSPå¢å¼ºæœç´¢ |
| **å†…å­˜ä½¿ç”¨** | 500MB | â‰¤600MB | å¢åŠ <100MB |
| **ç¼“å­˜å‘½ä¸­** | - | â‰¥70% | LSPå“åº”ç¼“å­˜ |

### åŸºå‡†æµ‹è¯•å·¥å…·

```typescript
// æ€§èƒ½åŸºå‡†æµ‹è¯•
class LSPBenchmark {
  async runBenchmark(projectPath: string): Promise<BenchmarkResult> {
    const metrics = await this.collectMetrics([
      'indexing_time',
      'memory_usage',
      'cache_performance',
      'error_rate'
    ]);
    
    return this.generateReport(metrics);
  }
}
```

## éƒ¨ç½²æ£€æŸ¥æ¸…å•

### é¢„éƒ¨ç½²æ£€æŸ¥

- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•é€šè¿‡
- [ ] å†…å­˜æ³„æ¼æµ‹è¯•é€šè¿‡
- [ ] é™çº§æœºåˆ¶æµ‹è¯•é€šè¿‡
- [ ] Dockeré•œåƒæ„å»ºæˆåŠŸ
- [ ] ç›‘æ§å‘Šè­¦é…ç½®å®Œæˆ

### éƒ¨ç½²æ­¥éª¤

```bash
# 1. æ„å»ºé•œåƒ
docker build -t codebase-index-lsp:latest .

# 2. è¿è¡Œæµ‹è¯•å®¹å™¨
docker run --rm codebase-index-lsp:latest npm test

# 3. æ€§èƒ½æµ‹è¯•
docker run --rm -v $(pwd)/test-data:/data codebase-index-lsp:latest npm run benchmark

# 4. ç”Ÿäº§éƒ¨ç½²
docker-compose -f docker-compose.lsp.yml up -d
```

### ä¸Šçº¿åç›‘æ§

- [ ] CPUä½¿ç”¨ç‡ç›‘æ§
- [ ] å†…å­˜ä½¿ç”¨ç‡ç›‘æ§
- [ ] å“åº”æ—¶é—´ç›‘æ§
- [ ] é”™è¯¯ç‡ç›‘æ§
- [ ] ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§
- [ ] è¯­è¨€æœåŠ¡å™¨å¥åº·æ£€æŸ¥

## æˆåŠŸæŒ‡æ ‡

### ä¸šåŠ¡æŒ‡æ ‡

- [ ] ä»£ç ç†è§£å‡†ç¡®ç‡æå‡ â‰¥ 40%
- [ ] æœç´¢ç›¸å…³æ€§æå‡ â‰¥ 30%
- [ ] å¼€å‘è€…æ»¡æ„åº¦ â‰¥ 80%
- [ ] æ–°åŠŸèƒ½ä½¿ç”¨ç‡ â‰¥ 60%

### æŠ€æœ¯æŒ‡æ ‡

- [ ] ç³»ç»Ÿå¯ç”¨æ€§ â‰¥ 99.9%
- [ ] LSPå“åº”æ—¶é—´ < 1000ms
- [ ] ç¼“å­˜å‘½ä¸­ç‡ â‰¥ 70%
- [ ] é”™è¯¯ç‡ < 1%

## åç»­è§„åˆ’

### Phase 5+ (å¯é€‰æ‰©å±•)

- **å¤šè¯­è¨€æ”¯æŒ**: Java, Go, Rustè¯­è¨€æœåŠ¡å™¨
- **IDEé›†æˆ**: VS Codeæ’ä»¶å¼€å‘
- **é«˜çº§åˆ†æ**: ä»£ç å¤æ‚åº¦ã€å®‰å…¨æ‰«æ
- **æœºå™¨å­¦ä¹ **: åŸºäºLSPæ•°æ®çš„æ™ºèƒ½æ¨è

### æŠ€æœ¯å€ºåŠ¡

- [ ] å‡çº§Tree-sitteråˆ°æœ€æ–°ç‰ˆæœ¬
- [ ] ä¼˜åŒ–GraphQLæŸ¥è¯¢æ€§èƒ½
- [ ] å®ç°åˆ†å¸ƒå¼LSPæœåŠ¡
- [ ] æ·»åŠ WebSocketå®æ—¶é€šä¿¡

## æ€»ç»“

æ•´ä¸ªLSPé›†æˆè®¡åˆ’é¢„è®¡ **6-7å‘¨** å®Œæˆï¼Œé‡‡ç”¨ **æ¸è¿›å¼å¢å¼º** ç­–ç•¥ï¼š

1. **ä½é£é™©**: æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ç‹¬ç«‹çš„å›æ»šæœºåˆ¶
2. **å¯éªŒè¯**: æ¯ä¸ªé˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„éªŒæ”¶æ ‡å‡†
3. **å¯æ‰©å±•**: æ¶æ„æ”¯æŒæœªæ¥æ›´å¤šè¯­è¨€æœåŠ¡å™¨
4. **é«˜æ€§èƒ½**: é€šè¿‡ç¼“å­˜å’Œä¼˜åŒ–ç¡®ä¿æ€§èƒ½å¯æ§

å®æ–½å®Œæˆåï¼ŒCodebase Indexå°†è·å¾—ä¼ä¸šçº§çš„è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼ŒåŒæ—¶ä¿æŒTree-sitterçš„é«˜æ€§èƒ½å’Œç¨³å®šæ€§ã€‚