# Semgrep模块快速参考卡片

## 🚀 30秒上手

```bash
# 1. 安装
pip install semgrep

# 2. 快速扫描
npm run scan

# 3. 查看结果
npm run results
```

## 📊 核心命令速查

| 操作 | 命令 | 示例 |
|------|------|------|
| **扫描项目** | `npm run scan --project=路径` | `npm run scan --project=./src` |
| **增量扫描** | 自动触发 | 文件变更时自动执行 |
| **查看结果** | `npm run results` | 显示最近扫描结果 |
| **生成报告** | `npm run report --format=html` | 生成HTML报告 |
| **管理规则** | `npm run rules` | 查看可用规则 |

## ⚙️ 常用配置速查

### 环境变量
```bash
export SEMGREP_BINARY_PATH=/usr/local/bin/semgrep
export SEMGREP_TIMEOUT=30000
export SEMGREP_JOBS=4
```

### 配置文件
```json
{
  "semgrep": {
    "enabled": true,
    "timeout": 30000,
    "jobs": 4,
    "exclude": ["node_modules", ".git"],
    "include": ["*.js", "*.ts", "*.py"]
  }
}
```

## 🔍 结果格式速记

### 发现结果结构
```typescript
interface Finding {
  ruleId: string;        // 规则ID
  message: string;       // 问题描述
  severity: 'ERROR' | 'WARNING' | 'INFO';
  file: string;          // 文件路径
  line: number;          // 行号
  column: number;        // 列号
  code: string;          // 问题代码
  fix?: string;          // 修复建议
}
```

### 快速查询
```bash
# 按严重程度过滤
grep '"severity": "ERROR"' results.json

# 按文件过滤
grep '"file": "src/' results.json

# 按规则过滤
grep '"ruleId": "javascript.security' results.json
```

## 🛠️ 故障速解

| 问题 | 症状 | 解决方案 |
|------|------|----------|
| **Semgrep未找到** | `command not found` | `export SEMGREP_BINARY_PATH=/正确路径/semgrep` |
| **扫描超时** | `timeout` 错误 | `export SEMGREP_TIMEOUT=60000` |
| **内存不足** | `memory` 错误 | `export SEMGREP_MAX_MEMORY=1024` |
| **规则错误** | `rule validation` 失败 | `semgrep --validate --config=./rules/` |

## 📈 性能指标速览

| 项目规模 | 扫描时间 | 内存使用 |
|----------|----------|----------|
| 小型 (<100文件) | < 1s | 100MB |
| 中型 (100-500) | 1-3s | 200MB |
| 大型 (500-1000) | 3-8s | 500MB |
| 超大型 (>1000) | 8-15s | 1GB |

## 🔧 调试技巧

### 开启调试
```bash
DEBUG=semgrep:* npm run scan
```

### 性能分析
```bash
semgrep --time --json > performance.json
```

### 规则测试
```bash
semgrep --test --config=./rules/ ./test-files/
```

## 📁 文件路径速记

| 文件类型 | 路径 | 说明 |
|----------|------|------|
| **配置文件** | `./config/semgrep.config.ts` | 主要配置 |
| **规则目录** | `./config/semgrep-rules/` | 自定义规则 |
| **日志文件** | `./logs/semgrep-*.log` | 运行日志 |
| **测试文件** | `./test/semgrep-test/` | 测试用例 |
| **结果文件** | `./results/semgrep-*.json` | 扫描结果 |

## 🔄 集成命令

### GitHub Actions
```yaml
- uses: returntocorp/semgrep-action@v1
  with:
    config: p/security-audit
```

### Pre-commit Hook
```bash
#!/bin/bash
semgrep --config=p/security-audit --error
```

### Docker
```bash
docker run --rm -v $(pwd):/src returntocorp/semgrep --config=auto /src
```

## 📞 支持速联

| 资源 | 链接 | 用途 |
|------|------|------|
| **官方文档** | https://semgrep.dev/docs | 完整文档 |
| **规则商店** | https://semgrep.dev/r | 现成规则 |
| **社区** | https://r2c.dev/slack | 技术支持 |
| **GitHub** | https://github.com/returntocorp/semgrep | 源码 |

## 🎯 最佳实践速记

1. **规则选择**: 从 `p/security-audit` 开始
2. **性能优化**: 使用 `--exclude` 排除大文件
3. **增量扫描**: 配置 `scanOnChange: true`
4. **结果管理**: 定期清理旧结果文件
5. **团队协作**: 使用共享规则配置

---

*打印此卡片，贴在显示器旁 🖨️*
*更新时间：2025-01-16*