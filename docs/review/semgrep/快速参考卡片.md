# Semgrepæ¨¡å—å¿«é€Ÿå‚è€ƒå¡ç‰‡

## ğŸš€ 30ç§’ä¸Šæ‰‹

```bash
# 1. å®‰è£…
pip install semgrep

# 2. å¿«é€Ÿæ‰«æ
npm run scan

# 3. æŸ¥çœ‹ç»“æœ
npm run results
```

## ğŸ“Š æ ¸å¿ƒå‘½ä»¤é€ŸæŸ¥

| æ“ä½œ | å‘½ä»¤ | ç¤ºä¾‹ |
|------|------|------|
| **æ‰«æé¡¹ç›®** | `npm run scan --project=è·¯å¾„` | `npm run scan --project=./src` |
| **å¢é‡æ‰«æ** | è‡ªåŠ¨è§¦å‘ | æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨æ‰§è¡Œ |
| **æŸ¥çœ‹ç»“æœ** | `npm run results` | æ˜¾ç¤ºæœ€è¿‘æ‰«æç»“æœ |
| **ç”ŸæˆæŠ¥å‘Š** | `npm run report --format=html` | ç”ŸæˆHTMLæŠ¥å‘Š |
| **ç®¡ç†è§„åˆ™** | `npm run rules` | æŸ¥çœ‹å¯ç”¨è§„åˆ™ |

## âš™ï¸ å¸¸ç”¨é…ç½®é€ŸæŸ¥

### ç¯å¢ƒå˜é‡
```bash
export SEMGREP_BINARY_PATH=/usr/local/bin/semgrep
export SEMGREP_TIMEOUT=30000
export SEMGREP_JOBS=4
```

### é…ç½®æ–‡ä»¶
```json
{
  "semgrep": {
    "enabled": true,
    "timeout": 30000,
    "jobs": 4,
    "exclude": ["node_modules", ".git"],
    "include": ["*.js", "*.ts", "*.py"]
  }
}
```

## ğŸ” ç»“æœæ ¼å¼é€Ÿè®°

### å‘ç°ç»“æœç»“æ„
```typescript
interface Finding {
  ruleId: string;        // è§„åˆ™ID
  message: string;       // é—®é¢˜æè¿°
  severity: 'ERROR' | 'WARNING' | 'INFO';
  file: string;          // æ–‡ä»¶è·¯å¾„
  line: number;          // è¡Œå·
  column: number;        // åˆ—å·
  code: string;          // é—®é¢˜ä»£ç 
  fix?: string;          // ä¿®å¤å»ºè®®
}
```

### å¿«é€ŸæŸ¥è¯¢
```bash
# æŒ‰ä¸¥é‡ç¨‹åº¦è¿‡æ»¤
grep '"severity": "ERROR"' results.json

# æŒ‰æ–‡ä»¶è¿‡æ»¤
grep '"file": "src/' results.json

# æŒ‰è§„åˆ™è¿‡æ»¤
grep '"ruleId": "javascript.security' results.json
```

## ğŸ› ï¸ æ•…éšœé€Ÿè§£

| é—®é¢˜ | ç—‡çŠ¶ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **Semgrepæœªæ‰¾åˆ°** | `command not found` | `export SEMGREP_BINARY_PATH=/æ­£ç¡®è·¯å¾„/semgrep` |
| **æ‰«æè¶…æ—¶** | `timeout` é”™è¯¯ | `export SEMGREP_TIMEOUT=60000` |
| **å†…å­˜ä¸è¶³** | `memory` é”™è¯¯ | `export SEMGREP_MAX_MEMORY=1024` |
| **è§„åˆ™é”™è¯¯** | `rule validation` å¤±è´¥ | `semgrep --validate --config=./rules/` |

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡é€Ÿè§ˆ

| é¡¹ç›®è§„æ¨¡ | æ‰«ææ—¶é—´ | å†…å­˜ä½¿ç”¨ |
|----------|----------|----------|
| å°å‹ (<100æ–‡ä»¶) | < 1s | 100MB |
| ä¸­å‹ (100-500) | 1-3s | 200MB |
| å¤§å‹ (500-1000) | 3-8s | 500MB |
| è¶…å¤§å‹ (>1000) | 8-15s | 1GB |

## ğŸ”§ è°ƒè¯•æŠ€å·§

### å¼€å¯è°ƒè¯•
```bash
DEBUG=semgrep:* npm run scan
```

### æ€§èƒ½åˆ†æ
```bash
semgrep --time --json > performance.json
```

### è§„åˆ™æµ‹è¯•
```bash
semgrep --test --config=./rules/ ./test-files/
```

## ğŸ“ æ–‡ä»¶è·¯å¾„é€Ÿè®°

| æ–‡ä»¶ç±»å‹ | è·¯å¾„ | è¯´æ˜ |
|----------|------|------|
| **é…ç½®æ–‡ä»¶** | `./config/semgrep.config.ts` | ä¸»è¦é…ç½® |
| **è§„åˆ™ç›®å½•** | `./config/semgrep-rules/` | è‡ªå®šä¹‰è§„åˆ™ |
| **æ—¥å¿—æ–‡ä»¶** | `./logs/semgrep-*.log` | è¿è¡Œæ—¥å¿— |
| **æµ‹è¯•æ–‡ä»¶** | `./test/semgrep-test/` | æµ‹è¯•ç”¨ä¾‹ |
| **ç»“æœæ–‡ä»¶** | `./results/semgrep-*.json` | æ‰«æç»“æœ |

## ğŸ”„ é›†æˆå‘½ä»¤

### GitHub Actions
```yaml
- uses: returntocorp/semgrep-action@v1
  with:
    config: p/security-audit
```

### Pre-commit Hook
```bash
#!/bin/bash
semgrep --config=p/security-audit --error
```

### Docker
```bash
docker run --rm -v $(pwd):/src returntocorp/semgrep --config=auto /src
```

## ğŸ“ æ”¯æŒé€Ÿè”

| èµ„æº | é“¾æ¥ | ç”¨é€” |
|------|------|------|
| **å®˜æ–¹æ–‡æ¡£** | https://semgrep.dev/docs | å®Œæ•´æ–‡æ¡£ |
| **è§„åˆ™å•†åº—** | https://semgrep.dev/r | ç°æˆè§„åˆ™ |
| **ç¤¾åŒº** | https://r2c.dev/slack | æŠ€æœ¯æ”¯æŒ |
| **GitHub** | https://github.com/returntocorp/semgrep | æºç  |

## ğŸ¯ æœ€ä½³å®è·µé€Ÿè®°

1. **è§„åˆ™é€‰æ‹©**: ä» `p/security-audit` å¼€å§‹
2. **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ `--exclude` æ’é™¤å¤§æ–‡ä»¶
3. **å¢é‡æ‰«æ**: é…ç½® `scanOnChange: true`
4. **ç»“æœç®¡ç†**: å®šæœŸæ¸…ç†æ—§ç»“æœæ–‡ä»¶
5. **å›¢é˜Ÿåä½œ**: ä½¿ç”¨å…±äº«è§„åˆ™é…ç½®

---

*æ‰“å°æ­¤å¡ç‰‡ï¼Œè´´åœ¨æ˜¾ç¤ºå™¨æ— ğŸ–¨ï¸*
*æ›´æ–°æ—¶é—´ï¼š2025-01-16*