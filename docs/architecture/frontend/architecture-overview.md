# 前端架构设计文档

## 概述

Codebase Index MCP 前端是一个基于 React 19 和 TypeScript 构建的现代化单页应用（SPA），采用 Vite 作为构建工具，提供代码库索引和检索的可视化界面。

## 技术栈

### 核心框架
- **React 19.1.1**: 最新版本的 React 框架，提供组件化开发模式
- **TypeScript 5.9.2**: 提供类型安全和更好的开发体验
- **Vite 7.1.5**: 快速的构建工具和开发服务器

### 状态管理
- **React Query 3.39.3**: 服务端状态管理，处理 API 数据获取和缓存
- **React Context**: 应用级状态管理（主题、认证等）

### 路由管理
- **React Router DOM 7.1.3**: 声明式路由管理

### 数据可视化
- **D3.js 7.9.0**: 数据驱动的文档操作库
- **Vis.js Network 10.0.1**: 网络图和关系图可视化
- **Vis.js Data 8.0.3**: 数据管理和操作

### HTTP 客户端
- **Axios 1.7.9**: 基于 Promise 的 HTTP 客户端

### 开发工具
- **ESLint 9.35.0**: 代码质量检查
- **Prettier 3.6.2**: 代码格式化
- **Jest 30.1.3**: 测试框架
- **Testing Library**: React 组件测试工具

## 项目结构

```
frontend/
├── public/                    # 静态资源
├── src/
│   ├── api/                   # API 适配器层
│   │   └── mcp-adapter/      # MCP 服务适配器
│   ├── components/           # React 组件
│   │   ├── common/          # 通用组件
│   │   ├── dashboard/       # 仪表板组件
│   │   ├── debug/           # 调试工具组件
│   │   ├── graph/           # 图形可视化组件
│   │   ├── projects/        # 项目管理组件
│   │   └── search/          # 搜索功能组件
│   ├── contexts/            # React Context 提供者
│   ├── hooks/               # 自定义 React Hooks
│   ├── services/            # 业务逻辑服务层
│   ├── styles/              # 样式文件
│   ├── types/               # TypeScript 类型定义
│   ├── utils/               # 工具函数
│   ├── App.tsx              # 主应用组件
│   └── main.tsx             # 应用入口文件
├── __tests__/               # 测试文件
├── __mocks__/               # 测试模拟数据
└── 配置文件                 # 各种构建和开发配置
```

## 架构设计原则

### 1. 分层架构

#### 表现层（Presentation Layer）
- **组件（Components）**: 负责 UI 渲染和用户交互
- **页面（Pages）**: 具体的页面级组件组合

#### 业务逻辑层（Business Logic Layer）
- **服务（Services）**: 处理业务逻辑和数据转换
- **Hooks**: 封装可复用的状态和副作用逻辑

#### 数据访问层（Data Access Layer）
- **API 适配器**: 与后端服务通信的接口适配器
- **类型定义**: 确保数据结构的类型安全

### 2. 组件设计模式

#### 容器组件模式
- **容器组件**: 负责数据获取和状态管理
- **展示组件**: 专注于 UI 渲染，通过 props 接收数据

#### 复合组件模式
- 将复杂组件拆分为多个可复用的子组件
- 通过组合方式构建复杂的用户界面

### 3. 状态管理策略

#### 本地状态
- **useState**: 组件内部状态管理
- **useReducer**: 复杂状态逻辑管理

#### 全局状态
- **React Context**: 应用级共享状态（主题、认证等）
- **React Query**: 服务端状态管理和缓存

#### 状态提升
- 将共享状态提升到最近的共同父组件
- 通过 props 向下传递数据和回调函数

## 核心功能模块

### 1. 路由系统

#### 路由配置
```typescript
// 主要页面路由
'/'           // 仪表板主页
'/projects'   // 项目管理
'/search'     // 代码搜索
'/graph'      // 图形可视化
'/debug'      // 调试工具
```

#### 路由守卫
- 基于 React Router 的权限控制
- 动态路由加载和懒加载支持

### 2. 组件架构

#### 通用组件（Common）
- **Layout**: 页面布局框架
- **Navigation**: 导航菜单
- **ErrorBoundary**: 错误边界处理
- **LoadingSpinner**: 加载状态显示

#### 功能组件（Feature Components）
- **Dashboard**: 系统状态仪表板
- **ProjectManagement**: 项目管理界面
- **CodeSearch**: 代码搜索功能
- **GraphVisualization**: 代码关系图展示
- **DebugTools**: 调试和诊断工具

### 3. 服务层架构

#### API 服务
- **ApiService**: 基础 HTTP 客户端封装
- **AuthService**: 认证和授权管理
- **ProjectService**: 项目相关业务逻辑
- **SearchService**: 搜索功能服务
- **GraphService**: 图形数据服务
- **MonitoringService**: 监控和指标服务
- **IndexingService**: 索引管理服务

#### 服务特性
- **请求拦截器**: 自动添加认证令牌
- **响应拦截器**: 统一错误处理和重试机制
- **缓存策略**: 智能缓存和失效机制
- **类型安全**: 完整的 TypeScript 类型定义

### 4. 数据流设计

#### 单向数据流
```
用户操作 → 组件事件 → 服务层 → API 调用 → 状态更新 → 组件重新渲染
```

#### 异步数据处理
- **React Query**: 管理异步状态和数据缓存
- **错误边界**: 捕获和处理组件错误
- **加载状态**: 统一的加载和错误状态管理

## 构建配置

### Vite 配置
- **开发服务器**: 支持热模块替换（HMR）
- **路径别名**: 简化模块导入路径
- **代理配置**: 开发环境 API 代理转发
- **代码分割**: 基于路由的代码分割

### TypeScript 配置
- **严格模式**: 启用所有严格类型检查
- **路径映射**: 与 Vite 别名保持一致
- **模块解析**: 使用现代模块解析策略

### 测试配置
- **Jest**: 单元测试框架
- **Testing Library**: React 组件测试
- **覆盖率**: 代码覆盖率报告生成
- **模拟数据**: 测试用模拟数据和函数

## 开发工作流

### 1. 开发环境
```bash
npm run dev      # 启动开发服务器
npm run test     # 运行测试
npm run lint     # 代码质量检查
npm run format   # 代码格式化
```

### 2. 构建流程
```bash
npm run build    # 生产环境构建
npm run preview  # 预览构建结果
```

### 3. 测试策略
- **单元测试**: 组件和业务逻辑测试
- **集成测试**: API 集成和端到端测试
- **覆盖率要求**: 关键业务逻辑 80%+ 覆盖率

## 性能优化

### 1. 代码分割
- **路由级分割**: 基于路由的代码分割
- **组件级分割**: 动态导入大型组件
- **第三方库分割**: vendor 包分离

### 2. 资源优化
- **图片优化**: 自动压缩和格式转换
- **字体优化**: 字体子集化和预加载
- **CSS 优化**: 按需加载和压缩

### 3. 运行时优化
- **虚拟滚动**: 大数据列表优化
- **防抖节流**: 高频事件优化
- **记忆化**: 昂贵的计算结果缓存

## 安全考虑

### 1. 输入验证
- **XSS 防护**: React 自动转义机制
- **CSRF 防护**: 请求令牌验证
- **输入校验**: 客户端输入验证

### 2. 认证授权
- **JWT 令牌**: 无状态认证机制
- **权限控制**: 基于角色的访问控制
- **会话管理**: 安全的会话存储

## 监控和调试

### 1. 错误监控
- **错误边界**: 组件级错误捕获
- **全局错误处理**: 未捕获异常处理
- **性能监控**: 核心指标监控

### 2. 调试工具
- **开发工具**: React DevTools 集成
- **日志系统**: 分级日志记录
- **性能分析**: 组件渲染性能分析

## 部署策略

### 1. 构建产物
- **静态文件**: HTML、CSS、JavaScript
- **资源优化**: 压缩和缓存优化
- **CDN 部署**: 静态资源 CDN 分发

### 2. 环境配置
- **环境变量**: 不同环境的配置管理
- **API 代理**: 生产环境 API 转发配置
- **健康检查**: 应用健康状态监控

## 扩展性设计

### 1. 插件架构
- **模块化设计**: 功能模块独立开发和部署
- **钩子系统**: 可扩展的生命周期钩子
- **配置驱动**: 基于配置的功能开关

### 2. 主题系统
- **CSS 变量**: 动态主题切换
- **样式模块化**: CSS Modules 支持
- **响应式设计**: 多设备适配支持

这个架构设计确保了前端应用的可维护性、可扩展性和高性能，为代码库索引和检索提供了优秀的用户体验。